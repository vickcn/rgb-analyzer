# 3D 視覺化色度演算模式支援

## 概述

本次更新為 3D 視覺化組件增加了多種色度演算模式支援，讓使用者可以在不同的色彩空間中觀察數據分布，並將系統預設模式改為色溫模式。

## 更新內容

### 1. 3D 視覺化多模式支援

#### 支援的色彩空間
- **RGB 模式**：傳統的紅綠藍三維空間
- **HSV 模式**：色相-飽和度-明度空間
- **HSL 模式**：色相-飽和度-亮度空間
- **色溫模式**：色溫-飽和度-明度混合空間

#### 座標系統轉換

**RGB 模式**：
- X軸：紅色 (0-255)
- Y軸：綠色 (0-255)
- Z軸：藍色 (0-255)

**HSV 模式**：
- X軸：色相 (0-360° → 0-255)
- Y軸：飽和度 (0-100% → 0-255)
- Z軸：明度 (0-100% → 0-255)

**HSL 模式**：
- X軸：色相 (0-360° → 0-255)
- Y軸：飽和度 (0-100% → 0-255)
- Z軸：亮度 (0-100% → 0-255)

**色溫模式**：
- X軸：色溫 (1000-10000K → 0-255)
- Y軸：飽和度 (0-100% → 0-255)
- Z軸：明度 (0-100% → 0-255)

#### 視覺化特色

**動態軸標籤**：
- RGB：R、G、B
- HSV：H (色相)、S (飽和度)、V (明度)
- HSL：H (色相)、S (飽和度)、L (亮度)
- 色溫：T (色溫)、S (飽和度)、V (明度)

**軸顏色編碼**：
- RGB：紅色、綠色、藍色
- HSV/HSL：粉紅、青綠、天藍
- 色溫：橙色、青綠、天藍

### 2. 系統預設模式變更

#### 變更內容
- **舊預設**：RGB 模式
- **新預設**：色溫模式

#### 影響範圍
- 主應用程式啟動時的預設模式
- 攝影機組件的預設顯示模式
- 3D 視覺化的預設座標系統

### 3. 技術實現

#### 核心函數

**座標轉換函數**：
```typescript
const getCoordinates = (rgbData: RGBData) => {
  switch (colorDisplayMode) {
    case 'rgb':
      return { x: rgbData.r, y: rgbData.g, z: rgbData.b };
      
    case 'hsv':
      const hsv = rgbData.hsv_h !== undefined ? 
        { h: rgbData.hsv_h, s: rgbData.hsv_s!, v: rgbData.hsv_v! } : 
        rgbToHSV(rgbData.r, rgbData.g, rgbData.b);
      return { 
        x: hsv.h * 255 / 360,  // 色相映射
        y: hsv.s * 255 / 100,  // 飽和度映射
        z: hsv.v * 255 / 100   // 明度映射
      };
      
    case 'colortemp':
      const colorTemp = rgbData.colorTemp !== undefined ? 
        rgbData.colorTemp : 
        rgbToColorTemp(rgbData.r, rgbData.g, rgbData.b).kelvin;
      return {
        x: Math.min(255, Math.max(0, (colorTemp - 1000) * 255 / 9000)),
        y: hsvForTemp.s * 255 / 100,
        z: hsvForTemp.v * 255 / 100
      };
  }
};
```

**軸標籤函數**：
```typescript
const getAxisLabels = () => {
  switch (colorDisplayMode) {
    case 'rgb': return { x: 'R', y: 'G', z: 'B' };
    case 'hsv': return { x: 'H (色相)', y: 'S (飽和度)', z: 'V (明度)' };
    case 'hsl': return { x: 'H (色相)', y: 'S (飽和度)', z: 'L (亮度)' };
    case 'colortemp': return { x: 'T (色溫)', y: 'S (飽和度)', z: 'V (明度)' };
  }
};
```

#### 資料流程

1. **模式選擇**：使用者在檢測控制面板選擇色度模式
2. **狀態傳遞**：`App.tsx` → `RGB3DVisualization.tsx`
3. **座標轉換**：每個數據點根據模式轉換座標
4. **視覺化更新**：軸標籤、顏色、投影位置同步更新

### 4. 使用場景

#### RGB 模式
- **適用**：傳統色彩分析、RGB 設備校準
- **特點**：直觀的三原色空間，易於理解

#### HSV 模式
- **適用**：色彩設計、藝術創作
- **特點**：色相環形分布，飽和度和明度線性變化

#### HSL 模式
- **適用**：網頁設計、UI/UX 色彩調整
- **特點**：亮度調整更符合人眼感知

#### 色溫模式
- **適用**：照明分析、色溫檢測
- **特點**：直觀顯示光源的冷暖特性

### 5. 互動功能

#### 保持的功能
- ✅ 滑鼠拖拽旋轉
- ✅ 滾輪縮放
- ✅ 觸控手勢支援
- ✅ 數據點資訊卡
- ✅ 平均值計算和顯示
- ✅ 連線顯示

#### 增強的功能
- 🆕 動態軸標籤更新
- 🆕 模式相關的軸顏色
- 🆕 座標系統即時切換
- 🆕 多空間數據分布分析

### 6. 性能優化

#### 計算效率
- 座標轉換函數使用快取的色度數據
- 避免重複的色彩空間轉換
- 智慧的重繪機制

#### 記憶體管理
- 轉換後的座標不額外儲存
- 即時計算減少記憶體佔用
- Canvas 渲染優化

### 7. 檔案更新清單

#### 主要修改
- `src/components/RGB3DVisualization.tsx`
  - 新增 `colorDisplayMode` 參數
  - 新增 `getCoordinates` 座標轉換函數
  - 新增 `getAxisLabels` 軸標籤函數
  - 新增 `getAxisColors` 軸顏色函數
  - 更新繪製邏輯使用轉換後的座標
  - 更新 useEffect 依賴項

- `src/App.tsx`
  - 預設模式改為 `'colortemp'`
  - 傳遞 `colorDisplayMode` 到 3D 視覺化組件

- `src/components/CameraCapture.tsx`
  - 預設模式改為 `'colortemp'`

### 8. 視覺效果

#### 不同模式的特色
- **RGB 立方體**：經典的色彩立方體，角落為純色
- **HSV 圓柱體**：色相形成圓形分布，中心軸為灰階
- **HSL 雙錐體**：中間為純色，兩端為黑白
- **色溫混合**：X軸顯示冷暖變化，YZ平面顯示色彩豐富度

#### 數據點分布特徵
- **RGB**：均勻分布在立方體內
- **HSV**：色相集中在特定角度，飽和度明度呈現線性關係
- **HSL**：亮度分布更符合視覺感知
- **色溫**：冷暖光源在X軸上明顯分離

### 9. 未來擴展

#### 可能的改進
1. **更多色彩空間**：CIE LAB、XYZ、YCbCr
2. **動畫過渡**：模式切換時的平滑動畫
3. **數據篩選**：根據色度範圍篩選顯示的點
4. **統計分析**：不同空間中的分布統計

#### 互動增強
1. **點擊選擇**：點擊數據點查看詳細資訊
2. **區域選取**：框選特定區域的數據點
3. **比較模式**：同時顯示多個色彩空間

## 總結

本次更新大幅增強了 3D 視覺化的分析能力，讓使用者能夠從不同角度觀察色彩數據的分布特徵。色溫模式作為新的預設選項，更符合照明和色彩分析的實際需求。

所有功能都保持了原有的流暢性和易用性，同時提供了更專業和多樣化的色彩分析工具。
